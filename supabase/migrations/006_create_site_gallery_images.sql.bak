-- Create table to store site-wide gallery images used by login/signup
CREATE TABLE IF NOT EXISTS site_gallery_images (
  id SERIAL PRIMARY KEY,
  image_url TEXT NOT NULL,
  image_path TEXT NOT NULL,
  uploaded_by TEXT NOT NULL,
  order_index INTEGER NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_site_gallery_images_created_at ON site_gallery_images(created_at);
CREATE INDEX IF NOT EXISTS idx_site_gallery_images_image_url ON site_gallery_images(image_url);

-- Enable RLS (optional; admin routes use service role)
ALTER TABLE site_gallery_images ENABLE ROW LEVEL SECURITY;

-- Allow public read via service role only (API uses service role). If you later want client reads,
-- add appropriate SELECT policies here.

-- Optional updated_at trigger if function exists
DO $$
BEGIN
  IF EXISTS (
    SELECT 1 FROM pg_proc WHERE proname = 'update_updated_at_column'
  ) THEN
    CREATE TRIGGER update_site_gallery_images_updated_at
    BEFORE UPDATE ON site_gallery_images
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
  END IF;
END $$;